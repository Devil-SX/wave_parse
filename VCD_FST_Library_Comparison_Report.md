# VCD/FST æ³¢å½¢è§£æåº“ç»¼åˆå¯¹æ¯”æŠ¥å‘Š

> åˆ†ææ—¶é—´ï¼š2026-02-16 | æ¶µç›– 11 ä¸ªåº“ | 3 ç§è¯­è¨€ (Rust / Python / C)

---

## ä¸€ã€æ€»è§ˆé€ŸæŸ¥è¡¨

| åº“ | è¯­è¨€ | æ ¼å¼ | è¯»/å†™ | ä»£ç é‡ | ä¾èµ– | è§£ææ–¹å¼ | æ¨èåœºæ™¯ |
|---|---|---|---|---|---|---|---|
| **wellen** | Rust | VCD+FST+GHW | R | ~13K | 11 | è‡ªå†™VCD+fst-reader+è‡ªå†™GHW | æ³¢å½¢æŸ¥çœ‹å™¨åç«¯ |
| **rust-vcd** | Rust | VCD | R/W | ~2.4K | 0 | æ‰‹å†™æµå¼ | é€šç”¨VCDå¤„ç† |
| **vcd-ng** | Rust | VCD | R/W | ~2.2K | 4 | æ‰‹å†™æµå¼+FastFlow | å¤§æ–‡ä»¶é«˜æ€§èƒ½VCD |
| **vcd_rust** | Rust | VCD | R(ä»…header) | ~1.5K | 4 | çŠ¶æ€æœº,è¡Œçº§ | ä¸æ¨è(æœªå®Œæˆ) |
| **EDA-Parsers** | Rust | VCD | R | ~2.0K | 3+1 | pest PEGè¯­æ³• | iEDAç”Ÿæ€é›†æˆ |
| **fst-reader** | Rust | FST | R | ~3.3K | 4 | çº¯Rustå—çº§ | çº¯Rust FSTè¯»å– |
| **fst-writer** | Rust | FST | W | ~1.3K | 3 | çº¯Rustå—çº§ | çº¯Rust FSTå†™å…¥ |
| **fst-tools/fstapi** | Rust | FST | R/W | ~1.1K+10K C | 0+C | C FFIåŒ…è£… | å®Œæ•´FSTåŠŸèƒ½+å¹¶è¡Œå†™ |
| **gtkwave/libfst** | C | FST(+VCDå·¥å…·) | R/W | ~7K+3K | zlib | å‚è€ƒå®ç° | æ ‡å‡†å‚è€ƒ/åµŒå…¥ |
| **vcdvcd** | Python | VCD | R | ~1K | 0 | é€è¡Œå­—ç¬¦æ´¾å‘ | Pythonå¿«é€Ÿè„šæœ¬ |
| **pylibfst** | Python | FST | R/W | ~0.2K+10K C | cffi+zlib | CFFIåŒ…è£…Cåº“ | Python FSTå¤„ç† |

---

## äºŒã€æŒ‰ç»´åº¦è¯¦ç»†å¯¹æ¯”

### 2.1 æ¶æ„ä¸è§£æç­–ç•¥

| åº“ | è§£æç­–ç•¥ | æµå¼/å…¨é‡ | å†…å­˜æ¨¡å‹ |
|---|---|---|---|
| **wellen** | VCD: æ‰‹å†™+mmap+å¤šçº¿ç¨‹åˆ†å—; FST: fst-readerä»£ç†; GHW: è‡ªå†™ | Headerå…¨é‡ + Bodyå¯æ‡’åŠ è½½ | wavemem LZ4å‹ç¼©å—å­˜å‚¨ |
| **rust-vcd** | æ‰‹å†™é€å­—èŠ‚, `BufRead`ä¸Šçš„`Iterator<Command>` | çœŸæ­£æµå¼ | ä»…Headeræ ‘åŒ–, Bodyé€æ¡è¿­ä»£ |
| **vcd-ng** | æ ‡å‡†ParseråŒrust-vcd + FastFlowé›¶æ‹·è´è¡Œè§£æå™¨ | æµå¼ + FastFlowæ‰¹é‡ | bitvec 2bit/å€¼, CompactString |
| **vcd_rust** | çŠ¶æ€æœº, é€è¡Œé€è¯ | å…¨é‡åŠ è½½ | HashMapå­˜å˜é‡, æ— å€¼å˜åŒ–å­˜å‚¨ |
| **EDA-Parsers** | pest PEGè¯­æ³•æ ‘ â†’ Rc<RefCell<>>ä½œç”¨åŸŸæ ‘ | å…¨é‡åŠ è½½ | VecDeque<Box<TimeAndValue>> |
| **fst-reader** | çº¯Rustå—çº§é¡ºåºè¯», æ³›å‹`BufRead+Seek` | å›è°ƒæµå¼ | æŒ‰å—è§£å‹, BitMaskä¿¡å·è¿‡æ»¤ |
| **fst-writer** | ä¸¤é˜¶æ®µBuilder(Headerâ†’Body), SingleVecLists | é¡ºåºå†™å…¥ | å•Vecå¤šé“¾è¡¨, LZ4å‹ç¼© |
| **fstapi** | C FFI â†’ GTKWave fstapi.c | å›è°ƒæµå¼/éšæœºè®¿é—® | Cç«¯mmap+å—ç¼“å­˜ |
| **gtkwave/libfst** | å•ä½“Cæ–‡ä»¶, mmap, å—çº§éšæœºè®¿é—® | å›è°ƒæµå¼/RVATéšæœº | mmapå€¼ä½ç½®+å½“å‰å€¼ç¼“å­˜ |
| **vcdvcd** | çº¯Pythoné€è¡Œreadline, if/elifå­—ç¬¦æ´¾å‘ | é»˜è®¤å…¨é‡, å¯å›è°ƒæµå¼ | list[(time,str)] + bisect |
| **pylibfst** | CFFI â†’ GTKWave fstapi.c (åŒgtkwave/libfst) | Cç«¯å›è°ƒ/éšæœº | Cç«¯å†…å­˜ç®¡ç† |

### 2.2 åŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½ | wellen | rust-vcd | vcd-ng | vcd_rust | EDA-P | fst-reader | fst-writer | fstapi | libfst | vcdvcd | pylibfst |
|---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| VCDè¯» | âœ… | âœ… | âœ… | âš ï¸ | âœ… | - | - | - | âœ…* | âœ… | - |
| VCDå†™ | - | âœ… | âœ… | - | - | - | - | - | âœ…* | - | - |
| FSTè¯» | âœ… | - | - | - | - | âœ… | - | âœ… | âœ… | - | âœ… |
| FSTå†™ | - | - | - | - | - | - | âœ… | âœ… | âœ… | - | âœ… |
| GHWè¯» | âœ… | - | - | - | - | - | - | - | - | - | - |
| ä¿¡å·è¿‡æ»¤ | âœ… | - | - | - | - | âœ… | - | âœ… | âœ… | âœ… | âœ… |
| æ—¶é—´èŒƒå›´è¿‡æ»¤ | âœ… | - | - | - | - | âœ… | - | âœ… | âœ… | âœ… | âœ… |
| éšæœºè®¿é—® | âœ… | - | - | - | - | - | - | âœ… | âœ… | âœ… | âœ… |
| å¤šçº¿ç¨‹ | âœ… | - | - | - | âš ï¸ | - | - | âœ…W | âœ…W | - | âœ…W |
| æµå¼API | âœ… | âœ… | âœ… | - | - | âœ… | - | âœ… | âœ… | âœ… | âœ… |
| å®æ•°å€¼ | âœ… | âœ… | âœ… | âš ï¸ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| 4å€¼é€»è¾‘(x/z) | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| 9å€¼é€»è¾‘ | âœ… | - | - | - | - | âœ… | âœ… | âœ… | âœ… | - | âœ… |
| æ€»çº¿ç´¢å¼•[7:0] | âœ… | âœ… | âœ… | - | âœ… | âœ… | âœ… | âœ… | âœ… | - | âœ… |
| VHDLç±»å‹ | âœ… | - | - | - | - | âœ… | - | âœ… | âœ… | - | âœ… |
| æšä¸¾è¡¨ | âœ… | - | - | - | - | âœ… | - | âœ… | âœ… | - | âœ… |
| C FFI | - | - | - | - | âœ… | - | - | âœ… | âœ… | - | âœ… |
| Pythonç»‘å®š | âœ… | - | - | - | - | - | - | - | - | âœ… | âœ… |

> âœ…=å®Œæ•´æ”¯æŒ, âš ï¸=éƒ¨åˆ†æ”¯æŒ, -=ä¸æ”¯æŒ, W=ä»…å†™å…¥ç«¯, *=é€šè¿‡å·¥å…·(vcd2fst/fst2vcd)

### 2.3 æ€§èƒ½æ¶æ„å¯¹æ¯”

| åº“ | é›¶æ‹·è´ | mmap | å¤šçº¿ç¨‹è§£æ | å‹ç¼©å­˜å‚¨ | ä¿¡å·æ‡’åŠ è½½ | å€¼ç¼–ç æ•ˆç‡ |
|---|:---:|:---:|:---:|:---:|:---:|---|
| **wellen** | - | âœ…(VCD) | âœ…(rayon) | âœ…(wavemem LZ4) | âœ…(FST) | 2/4/9-stateè‡ªé€‚åº” |
| **rust-vcd** | - | - | - | - | - | 8bit/å€¼(Vec<Value>) |
| **vcd-ng** | âœ…(FastFlow) | - | - | - | - | 2bit/å€¼(bitvec) |
| **fst-reader** | - | - | - | - | - | å›è°ƒå¼ä¸å­˜å‚¨ |
| **fst-writer** | - | - | - | âœ…(LZ4) | - | SingleVecLists |
| **fstapi** | - | âœ…(C) | âœ…W(pthread) | âœ…(C) | - | Cç«¯ä¼˜åŒ–ç¼–ç  |
| **gtkwave/libfst** | - | âœ… | âœ…W(pthread) | âœ…(zlib/LZ4/FastLZ) | âœ…(RVAT) | 1bitä¿¡å·2bitç¼–ç  |
| **vcdvcd** | - | - | - | - | - | Python str/å…ƒç»„ |
| **pylibfst** | - | âœ…(C) | âœ…W(C) | âœ…(C) | âœ…(C RVAT) | Cç«¯ç¼–ç  |

### 2.4 ä¾èµ–ä¸æ„å»ºå¤æ‚åº¦

| åº“ | è¿è¡Œæ—¶ä¾èµ– | æ„å»ºä¾èµ– | ç³»ç»Ÿä¾èµ– | å®‰è£…éš¾åº¦ |
|---|---|---|---|---|
| **wellen** | 11ä¸ªçº¯Rust crate | cargo | - | â­ ç®€å• |
| **rust-vcd** | **0** | cargo | - | â­ æœ€ç®€å• |
| **vcd-ng** | 4ä¸ªçº¯Rust crate | cargo | - | â­ ç®€å• |
| **vcd_rust** | 4ä¸ªRust crate | cargo | - | â­ ç®€å• |
| **EDA-Parsers** | 3ä¸ªRust + cbindgen | cargo | - | â­â­ ä¸­ç­‰ |
| **fst-reader** | 4ä¸ªçº¯Rust crate | cargo | - | â­ ç®€å• |
| **fst-writer** | 3ä¸ªçº¯Rust crate | cargo | - | â­ ç®€å• |
| **fstapi** | 0 Rust | cargo + cc + bindgen | zlib, Cç¼–è¯‘å™¨ | â­â­â­ å¤æ‚ |
| **gtkwave/libfst** | - | Cç¼–è¯‘å™¨ | zlib | â­â­ ä¸­ç­‰ |
| **vcdvcd** | **0** | pip | - | â­ æœ€ç®€å• |
| **pylibfst** | cffi | cmake + Cç¼–è¯‘å™¨ | zlib-dev | â­â­â­ å¤æ‚ |

### 2.5 ä»£ç è´¨é‡ä¸æˆç†Ÿåº¦

| åº“ | ç‰ˆæœ¬ | ä»£ç è¡Œæ•° | æµ‹è¯• | æ–‡æ¡£ | æœ€åæ´»è·ƒ | è´¡çŒ®è€… | æˆç†Ÿåº¦ |
|---|---|---|---|---|---|---|---|
| **wellen** | 0.20.2 (88ä¸ªrelease) | ~13K Rust | 149ä¸ªæµ‹è¯•è¾“å…¥æ–‡ä»¶, proptest, CI | README+æ–‡æ¡£æ³¨é‡Š | 2026-02 | 9 | ğŸŸ¢ ç”Ÿäº§çº§ |
| **rust-vcd** | 0.7.0 | ~2.4K Rust | 5ä¸ªç»¼åˆæµ‹è¯•+å•å…ƒæµ‹è¯• | å®Œæ•´æ–‡æ¡£æ³¨é‡Š+ç¤ºä¾‹ | 2024-02 | 8 | ğŸŸ¢ ç”Ÿäº§çº§ |
| **vcd-ng** | 0.2.0 | ~2.2K Rust | 4+1ä¸ªæµ‹è¯• | ä¸­ç­‰ | æœªçŸ¥ | 1 | ğŸŸ¡ å¯ç”¨ |
| **vcd_rust** | 0.0.1 | ~1.5K Rust | 28ä¸ªå•å…ƒæµ‹è¯• | è‰¯å¥½(Headeréƒ¨åˆ†) | 2021-01 | 1 | ğŸ”´ å·²åºŸå¼ƒ |
| **EDA-Parsers** | 0.1.0 | ~2.0K Rust+115 pest | 8ä¸ªæµ‹è¯•(è·¯å¾„ä¸å¯ç§»æ¤) | æœ€å°‘ | 2023-11 | ç»„ç»‡ | ğŸŸ¡ é¢†åŸŸç‰¹å®š |
| **fst-reader** | 0.14.3 | ~3.3K Rust | proptest+diffå¯¹ç…§Cå‚è€ƒ | æ–‡æ¡£æ³¨é‡Š+FSTæ–‡æ¡£ | 2026+ | 1 | ğŸŸ¢ ç”Ÿäº§çº§ |
| **fst-writer** | 0.3.1 | ~1.3K Rust | proptest+è¯»å›éªŒè¯ | æœ€å°‘ | 2026+ | 1 | ğŸŸ¡ å¹´è½»å¯ç”¨ |
| **fstapi** | 0.0.3 | ~1.1K Rust+10K C | æ— (é€šè¿‡CLIå·¥å…·æµ‹è¯•) | æ–‡æ¡£æ³¨é‡Š | æ´»è·ƒ | 1 | ğŸŸ¡ è–„åŒ…è£…,Cæ ¸å¿ƒç¨³å®š |
| **gtkwave/libfst** | - | ~10K C | é€šè¿‡GTKWaveé›†æˆæµ‹è¯• | block_format.txt | 2009-2023 | 1(Tony Bybell) | ğŸŸ¢ ä¸šç•Œæ ‡å‡† |
| **vcdvcd** | 2.6.0 | ~1K Python | 13ä¸ªunittest | å®Œæ•´docstring | 2023-12 | ~12 | ğŸŸ¢ ç¨³å®š |
| **pylibfst** | 0.2.2-dev | ~0.2K Py+10K C | 6ä¸ªé›†æˆæµ‹è¯• | è¾…åŠ©å‡½æ•°docstring | 2025-06 | 1 | ğŸŸ¡ å¯ç”¨ |

---

## ä¸‰ã€æ¶æ„æ·±åº¦å¯¹æ¯”

### 3.1 VCD è§£ææ¶æ„è°±ç³»

```
rust-vcd (2017)                    ç‹¬ç«‹å®ç°
    â”‚                              â”€ æ‰‹å†™é€å­—èŠ‚æµå¼, Iterator<Command>
    â”‚                              â”€ é›¶ä¾èµ–, BufReadæ³›å‹
    â”‚
    â”œâ”€â”€â–¶ vcd-ng (fork)             æ€§èƒ½åˆ†æ”¯
    â”‚       â”€ FastFlowé›¶æ‹·è´è¡Œè§£æå™¨(æ•°æ®æ®µä¸“ç”¨)
    â”‚       â”€ bitvec 2bit/å€¼, CompactString, atoi_radix10
    â”‚       â”€ å«unsafeè‡ªå¼•ç”¨ç”Ÿå‘½å‘¨æœŸ
    â”‚
    â””â”€â”€â–¶ wellen (å†…éƒ¨é‡å†™)          ç»Ÿä¸€æ¡†æ¶å†…çš„VCDè§£æ
            â”€ mmap + rayonå¤šçº¿ç¨‹åˆ†å—è§£æ
            â”€ wavemem LZ4å‹ç¼©å†…å­˜å­˜å‚¨
            â”€ GTKWave/NVCå±æ€§æ‰©å±•æ”¯æŒ

vcd_rust (2020)                    ç‹¬ç«‹å®ç°(å·²åºŸå¼ƒ)
    â”€ çŠ¶æ€æœº, ä»…è§£æHeader
    â”€ æ— å€¼å˜åŒ–å­˜å‚¨, v0.0.1ååœæ›´

EDA-Parsers/vcd_parser (2023)      ç‹¬ç«‹å®ç°(é¢†åŸŸç‰¹å®š)
    â”€ pest PEGè¯­æ³•, å…¨é‡åŠ è½½
    â”€ Rc<RefCell<>>ä½œç”¨åŸŸæ ‘
    â”€ C FFI + ä¿¡å·åˆ†æ(TC/SP)

vcdvcd (Python, 2016)              ç‹¬ç«‹å®ç°
    â”€ çº¯Python, readlineé€è¡Œ
    â”€ bisectéšæœºè®¿é—®, å¯é€‰Scopeå±‚çº§
```

### 3.2 FST è§£ææ¶æ„è°±ç³»

```
gtkwave/libfst (Cå‚è€ƒ, 2009)       æ ‡å‡†å®ç°
    â”‚   â”€ å•ä½“fstapi.c ~7Kè¡Œ
    â”‚   â”€ mmap, å—çº§éšæœº, RVAT
    â”‚   â”€ å¹¶è¡Œå‹ç¼©å†™å…¥(pthread)
    â”‚
    â”œâ”€â”€â–¶ fstapi (Rust FFI, MaxXSoft)
    â”‚       â”€ è–„RuståŒ…è£…, bindgenç”Ÿæˆ
    â”‚       â”€ ç»§æ‰¿å…¨éƒ¨Cæ€§èƒ½+åŠŸèƒ½
    â”‚       â”€ éœ€Cç¼–è¯‘å™¨+zlib
    â”‚
    â”œâ”€â”€â–¶ pylibfst (Python CFFI, mschlaegl)
    â”‚       â”€ CFFI APIæ¨¡å¼ç»‘å®š
    â”‚       â”€ è‡ªå®šä¹‰fstext.cæ—¶é—´æˆ³æå–
    â”‚       â”€ éœ€cmake+Cç¼–è¯‘å™¨+zlib
    â”‚
    â””â”€â”€â–¶ fst-reader (çº¯Rust, ekiwi)     ç‹¬ç«‹é‡å†™
            â”€ çº¯Rust, é›¶Cä¾èµ–
            â”€ miniz_oxide + lz4_flex + è‡ªå†™FastLZ
            â”€ proptest + diffæµ‹è¯•å¯¹ç…§Cå‚è€ƒ
            â”€ æ”¯æŒä¸å®Œæ•´FST(.hieræ–‡ä»¶)
            â”‚
            â””â”€â”€â–¶ wellen (é›†æˆ)
                    â”€ ä½œä¸ºFSTåç«¯, æ‡’åŠ è½½ä¿¡å·

fst-writer (çº¯Rust, ekiwi)          fst-readerçš„é…å¯¹å†™å…¥å™¨
    â”€ DynamicAlias2æ ¼å¼
    â”€ SingleVecListsæ•°æ®ç»“æ„
    â”€ æ— å¹¶è¡Œå†™å…¥(vs Cç‰ˆæœ‰)
```

### 3.3 wellen ç»Ÿä¸€æŠ½è±¡å±‚è®¾è®¡

wellen çš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå°†ä¸‰ç§æˆªç„¶ä¸åŒçš„æ ¼å¼ç»Ÿä¸€åˆ°åŒä¸€å¥—æŠ½è±¡ä¸‹ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ç”¨æˆ·APIå±‚   â”‚
                    â”‚ Simple/Viewerâ”‚
                    â”‚  /Streaming  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VCDè§£æå™¨  â”‚  â”‚ FSTé€‚é…å™¨  â”‚  â”‚  GHWè§£æå™¨  â”‚
    â”‚ (è‡ªå†™,mmap) â”‚  â”‚(fst-reader)â”‚  â”‚   (è‡ªå†™)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚            â”‚            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      Hierarchy          â”‚
              â”‚ (ç»Ÿä¸€ä½œç”¨åŸŸ/å˜é‡æ¨¡å‹)     â”‚
              â”‚ + StringInterner        â”‚
              â”‚ + SignalRef(NonZeroU32)  â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚      SignalSource       â”‚
              â”‚ (trait: æŒ‰éœ€åŠ è½½ä¿¡å·)    â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚      wavemem            â”‚
              â”‚ (LZ4å‹ç¼©å—å†…å­˜å­˜å‚¨)     â”‚
              â”‚ + LEB128æ—¶é—´ç¼–ç         â”‚
              â”‚ + 2/4/9-stateè‡ªé€‚åº”     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å…³é”®æŠ€æœ¯äº®ç‚¹

### 4.1 wellen wavemem å‹ç¼©å­˜å‚¨
- çµæ„Ÿæ¥è‡ªFSTç£ç›˜æ ¼å¼ï¼Œä½†ç”¨äº**å†…å­˜ä¸­**ä¿¡å·å­˜å‚¨
- åˆ†å— + LZ4å‹ç¼© + LEB128æ—¶é—´å¢é‡ç¼–ç 
- 2-state (1bit/å€¼) / 4-state (2bit/å€¼) / 9-state (4bit/å€¼) **è‡ªé€‚åº”**ç¼–ç 
- æ”¯æŒrayonå¹¶è¡Œè§£å‹ä¿¡å·

### 4.2 vcd-ng FastFlow é›¶æ‹·è´è§£æ
- ä¸“ç”¨äºVCDæ•°æ®æ®µçš„é«˜é€Ÿè§£æå™¨
- `linereader` ç¼“å†²è¡Œè¯»å–ï¼Œå€¼å¼•ç”¨ç›´æ¥æŒ‡å‘å†…éƒ¨buffer
- ç‰ºç‰²é€šç”¨æ€§ï¼ˆä¸å¤„ç†`$`å‘½ä»¤ã€å®æ•°å€¼ï¼‰æ¢å–ååé‡

### 4.3 gtkwave/libfst åŠ¨æ€åˆ«å
- å†™å…¥flushæ—¶ï¼Œç”¨Jenkinså“ˆå¸Œæ£€æµ‹ç›¸åŒå€¼å˜åŒ–æ¨¡å¼çš„ä¿¡å·
- ç›¸åŒæ¨¡å¼åªå­˜ä¸€ä»½ï¼Œå…¶ä½™ä¿¡å·é€šè¿‡åˆ«åç´¢å¼•å¼•ç”¨
- DynamicAlias2ä½¿ç”¨æœ‰ç¬¦å·varintè¿›ä¸€æ­¥ä¼˜åŒ–

### 4.4 fst-writer SingleVecLists
- å•ä¸ª`Vec<u8>`å­˜å‚¨å¤šæ¡è¿½åŠ é“¾è¡¨
- æ¯æ¡ç›®: 4å­—èŠ‚å›æŒ‡é’ˆ + å˜é•¿æ•°æ®
- é¿å…æ¯ä¿¡å·å•ç‹¬`Vec`åˆ†é…çš„å†…å­˜å¼€é”€

### 4.5 gtkwave/libfst å•æ¯”ç‰¹ä¿¡å·ç¼–ç 
- `((val&1)<<1) | (time_delta<<2)` â€” 0/1å€¼ä»…2bitå¼€é”€
- x/z/h/u/w/l/-: 4bitå‰ç¼€ + time_delta
- è®¾è®¡ä¸º**æ— åˆ†æ”¯è§£ç **: `shcnt = 2 << (vli & 1)`

---

## äº”ã€ä½¿ç”¨åœºæ™¯æ¨è

### åœºæ™¯ 1: Rustæ³¢å½¢æŸ¥çœ‹å™¨åç«¯
> **æ¨è: wellen**
>
> å”¯ä¸€åŒæ—¶æ”¯æŒVCD+FST+GHWçš„ç»Ÿä¸€åº“ã€‚ä¸‰ç§è®¿é—®æ¨¡å¼(Viewer/Simple/Streaming)è¦†ç›–æ‰€æœ‰GUIéœ€æ±‚ã€‚å¤šçº¿ç¨‹VCDè§£æ + FSTæ‡’åŠ è½½ + wavememå‹ç¼©å­˜å‚¨ã€‚Surferæ³¢å½¢æŸ¥çœ‹å™¨çš„ç”Ÿäº§çº§åç«¯ã€‚

### åœºæ™¯ 2: Rusté€šç”¨VCDè¯»å†™
> **æ¨è: rust-vcd**
>
> é›¶ä¾èµ–ï¼Œå®Œæ•´è¯»å†™ï¼ŒçœŸæ­£æµå¼Iterator APIï¼Œä¼˜ç§€çš„é”™è¯¯æŠ¥å‘Š(å¸¦è¡Œå·)ã€‚8ä½è´¡çŒ®è€…ï¼Œv0.7.0æˆç†Ÿç¨³å®šã€‚æœ€ä½³é€šç”¨é€‰æ‹©ã€‚

### åœºæ™¯ 3: Rusté«˜æ€§èƒ½å¤§æ–‡ä»¶VCDå¤„ç†
> **æ¨è: vcd-ng**
>
> FastFlowé›¶æ‹·è´è§£æå™¨ + bitvec 2bit/å€¼å­˜å‚¨ï¼Œä¸“ä¸ºå¤§æ–‡ä»¶ä¼˜åŒ–ã€‚æ¯”rust-vcdå¤š4ä¸ªä¾èµ–ï¼Œå«å°‘é‡unsafeä»£ç ï¼Œæ¢å–æ˜¾è‘—æ€§èƒ½æå‡ã€‚

### åœºæ™¯ 4: Rustçº¯FSTè¯»å–(æ— Cä¾èµ–)
> **æ¨è: fst-reader + fst-writer**
>
> åŒä¸€ä½œè€…(ekiwi)çš„é…å¯¹åº“ï¼Œçº¯Rustå®ç°ï¼Œé›¶Cä¾èµ–ã€‚fst-readeræ”¯æŒå…¨éƒ¨FSTç‰¹æ€§å«ä¸å®Œæ•´æ–‡ä»¶ã€‚proptest + diffæµ‹è¯•ä¿è¯æ­£ç¡®æ€§ã€‚

### åœºæ™¯ 5: Rustå®Œæ•´FSTåŠŸèƒ½(å«å¹¶è¡Œå†™å…¥)
> **æ¨è: fst-tools/fstapi**
>
> ç›´æ¥åŒ…è£…GTKWave Cå‚è€ƒå®ç°ï¼Œç»§æ‰¿å…¨éƒ¨åŠŸèƒ½(å¹¶è¡Œå†™å…¥ã€mmapã€æ‰€æœ‰å‹ç¼©ç®—æ³•)ã€‚ä»£ä»·: éœ€è¦Cç¼–è¯‘å™¨å’Œzlibã€‚

### åœºæ™¯ 6: Pythonå¿«é€ŸVCDè„šæœ¬
> **æ¨è: vcdvcd**
>
> é›¶ä¾èµ–çº¯Python, `pip install vcdvcd`å³ç”¨ã€‚Pythonicçš„`vcd['signal'][time]`è¯­æ³•ï¼Œbisectéšæœºè®¿é—®ã€‚é€‚åˆä¸­å°æ–‡ä»¶å¿«é€Ÿåˆ†æã€‚

### åœºæ™¯ 7: Python FSTå¤„ç†
> **æ¨è: pylibfst**
>
> CFFIåŒ…è£…GTKWave Cåº“ï¼Œç»§æ‰¿Cçº§æ€§èƒ½ã€‚æ”¯æŒè¯»å†™ã€‚éœ€è¦Cç¼–è¯‘ç¯å¢ƒã€‚é€‚åˆå¤„ç†å¤§å‹FSTæ–‡ä»¶ã€‚

### åœºæ™¯ 8: C/C++ EDAå·¥å…·åµŒå…¥FSTæ”¯æŒ
> **æ¨è: gtkwave/libfst (fstapi.c)**
>
> ä¸šç•Œæ ‡å‡†å‚è€ƒå®ç°ã€‚6ä¸ªæ–‡ä»¶å³å¯ç‹¬ç«‹ç¼–è¯‘ã€‚Verilatorã€Icarus Verilogç­‰å·²å¹¿æ³›ä½¿ç”¨ã€‚æ³¨æ„: é”™è¯¯è·¯å¾„ä¼š`exit(255)`ï¼Œéœ€è¦å¯¹åº“æ¶ˆè´¹è€…åšé˜²æŠ¤ã€‚

### åœºæ™¯ 9: iEDAç”Ÿæ€VCDé›†æˆ
> **æ¨è: EDA-Parsers/vcd_parser**
>
> pest PEGè¯­æ³•æä¾›å½¢å¼åŒ–è§„èŒƒã€‚C FFI + cbindgenç”Ÿæˆå¤´æ–‡ä»¶ã€‚å†…ç½®ä¿¡å·åˆ†æ(ç¿»è½¬è®¡æ•°/ä¿¡å·æŒç»­æ—¶é—´)ã€‚ä»…é€‚ç”¨äºiEDAç”Ÿæ€ã€‚

---

## å…­ã€å·²çŸ¥å±€é™æ±‡æ€»

| åº“ | ä¸»è¦å±€é™ |
|---|---|
| **wellen** | æ— å†™å…¥æ”¯æŒ; GHWæµå¼æœªå®ç°; å¤šçº¿ç¨‹VCDä»…æ–‡ä»¶è¾“å…¥(éœ€mmap); GHWä¸æ”¯æŒå‹ç¼©æ–‡ä»¶ |
| **rust-vcd** | Vectorç”¨8bit/å€¼(å†…å­˜æ•ˆç‡ä½); æ— ä¿¡å·è¿‡æ»¤; æ— å¤šçº¿ç¨‹ |
| **vcd-ng** | æ ‡å‡†Parserç”¨`io::Bytes`(æ— ç¼“å†²,æ¯”rust-vcdä½æ•ˆ); FastFlowä¸æ”¯æŒå®æ•°å’Œ`$`å‘½ä»¤; å«unsafe |
| **vcd_rust** | **ä»…è§£æHeader**, æ— å€¼å˜åŒ–å­˜å‚¨, å·²åºŸå¼ƒ(2021), ä¸æ”¯æŒfsæ—¶é—´å•ä½ |
| **EDA-Parsers** | è¯­æ³•é¡ºåºå›ºå®š(dateâ†’timescaleâ†’comment); æ— $version; å…¨é‡åŠ è½½; debug printlnæ®‹ç•™; æµ‹è¯•è·¯å¾„ç¡¬ç¼–ç  |
| **fst-reader** | ä»…è¯»å–,æ— å†™å…¥; Hierarchyå’ŒGZipå®Œå…¨è§£å‹åˆ°å†…å­˜ |
| **fst-writer** | æ— å¹¶è¡Œå†™å…¥; ä¸æ”¯æŒå±æ€§/æšä¸¾è¡¨/VHDL info; Geometryæœªå‹ç¼© |
| **fstapi** | Erroræœªå®ç°std::error::Error; ä¸æ˜¯Send/Sync; FFIå­—ç¬¦ä¸²è½¬æ¢å¼€é”€ |
| **gtkwave/libfst** | é”™è¯¯è·¯å¾„è°ƒexit(255); å•ä½“7Kè¡Œæ–‡ä»¶; void*ä¸ç±»å‹å®‰å…¨; Readeréçº¿ç¨‹å®‰å…¨; éœ€seekableè¾“å…¥ |
| **vcdvcd** | çº¯Pythonæ€§èƒ½ç“¶é¢ˆ; æ— å¹¶è¡Œ; æ— mmap; æ— å†™å…¥; åŒè¡Œå‘é‡å€¼å˜åŒ–ä¼šæŠ›å¼‚å¸¸ |
| **pylibfst** | éœ€Cç¼–è¯‘ç¯å¢ƒ; APIè¾ƒåº•å±‚(Cé£æ ¼); æ— ç±»å‹æç¤º; æ‰‹åŠ¨å†…å­˜é‡Šæ”¾ |

---

## ä¸ƒã€ç”Ÿæ€å…³ç³»å›¾

```
                           Kevin Laeufer (ekiwi)
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚              â”‚
              fst-reader      fst-writer       wellen
              (çº¯Rust FSTè¯»)  (çº¯Rust FSTå†™)   (ç»Ÿä¸€VCD+FST+GHW)
                    â”‚                            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€ è¢«wellenä¾èµ– â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                            Surferæ³¢å½¢æŸ¥çœ‹å™¨

              Tony Bybell
                    â”‚
            gtkwave/libfst (Cå‚è€ƒ)
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚
    fstapi(Rust FFI)    pylibfst(Python CFFI)
    (MaxXSoft)          (Manfred SCHLAEGL)

              Kevin Mehall
                    â”‚
              rust-vcd (Rust VCD)
                    â”‚
              vcd-ng (æ€§èƒ½fork)
              (Zizheng Guo)

              Ciro Santilli
                    â”‚
              vcdvcd (Python VCD)

              OSCC/iEDA
                    â”‚
         EDA-Parsers/vcd_parser
```

---

## å…«ã€å®æµ‹æ€§èƒ½å¯¹æ¯”ä¸åˆ†æ

> åŸºå‡†æµ‹è¯•ç¯å¢ƒ: Linux 6.6.87 / Python 3.13.5 / Rust 2021 edition / æµ‹è¯•æ–‡ä»¶è§„æ¨¡ small(44KB) + medium(637KB~14MB) + large(176MB~49MB)
> å…± 220 æ¡åŸºå‡†è®°å½•ï¼Œè¦†ç›– 8 ä¸ªåº“ Ã— 5 ä¸ªæ“ä½œ (full_parse / signal_list / value_query / pipelineè¿ç»­æ“ä½œ)

#### åŸºå‡†æµ‹è¯•æ–¹æ³•è¯´æ˜

æ¯é¡¹æµ‹è¯•è¿è¡Œ **3 æ¬¡å–å¹³å‡å€¼**ï¼Œå¹¶è®°å½•æ ‡å‡†å·®å’Œå³°å€¼å†…å­˜ã€‚æµ‹è¯•æ¶µç›–ä»¥ä¸‹ 5 ä¸ªæ“ä½œï¼š

| æµ‹è¯•é¡¹ | å«ä¹‰ | å…·ä½“æ“ä½œ |
|--------|------|----------|
| **full_parse** | å…¨é‡è§£æ | åŠ è½½æ•´ä¸ªæ³¢å½¢æ–‡ä»¶ï¼Œè§£ææ–‡ä»¶å¤´ + å…¨éƒ¨å€¼å˜åŒ–æ•°æ®åˆ°å†…å­˜ |
| **signal_list** | ä¿¡å·æšä¸¾ | è§£ææ–‡ä»¶ï¼Œåˆ—ä¸¾æ‰€æœ‰ä¿¡å·åç§°åŠå…¶å±‚çº§è·¯å¾„ |
| **time_range** | æ—¶é—´èŒƒå›´ | è¯»å–æ³¢å½¢çš„èµ·æ­¢æ—¶é—´æˆ³ï¼ˆä»… Python ç«¯ç‹¬ç«‹æµ‹è¯•ï¼›Rust ç«¯åˆå¹¶åˆ° pipeline ä¸­ï¼‰ |
| **value_query** | å€¼æŸ¥è¯¢ | é€‰å–ç‰¹å®šä¿¡å·ï¼Œè¯»å–å…¶å…¨éƒ¨å€¼å˜åŒ–è®°å½• |
| **pipeline** | è¿ç»­æ“ä½œ | ç«¯åˆ°ç«¯æµç¨‹ï¼šåŠ è½½ â†’ ä¿¡å·æšä¸¾ â†’ æ—¶é—´èŒƒå›´ â†’ å€¼æŸ¥è¯¢ï¼Œä¸€æ¬¡æ€§å®Œæˆ |

**Python ä¸ Rust å®ç°å·®å¼‚ï¼š**

- **Python** ç«¯ (`vcdvcd` / `pylibfst` / `pywellen`)ï¼š`value_query` é€‰å– 3 ä¸ªä¿¡å·ï¼Œåˆ†åˆ«åœ¨ 10%ã€50%ã€100% ä½ç½®é‡‡æ ·ï¼ŒæŸ¥è¯¢å„è‡ªçš„å€¼å˜åŒ–ï¼›`time_range` ä½œä¸ºç‹¬ç«‹æµ‹è¯•é¡¹å•ç‹¬è®¡æ—¶ã€‚
- **Rust** ç«¯ (`wellen` / `rust-vcd` / `vcd-ng` / `fst-reader` / `fstapi`)ï¼š`value_query` é€‰å– 10 ä¸ªä¿¡å·ï¼ŒæŸ¥è¯¢å…¨æ—¶é—´èŒƒå›´çš„å€¼å˜åŒ–ï¼›`time_range` ä¸å•ç‹¬æµ‹è¯•ï¼Œå…¶è€—æ—¶åŒ…å«åœ¨ `pipeline` ä¸­ã€‚
- ä¸¤ç«¯æµ‹è¯•æ–‡ä»¶ç›¸åŒï¼ˆåˆæˆ bench_*.vcd/.fst + çœŸå®ä¸–ç•Œ real_world_*.vcd/.fstï¼‰ï¼Œä½†ç”±äºæŸ¥è¯¢ä¿¡å·æ•°é‡å’ŒèŒƒå›´ä¸åŒï¼Œ**Python ä¸ Rust çš„ value_query ç»“æœä¸å®œç›´æ¥æ¨ªå‘å¯¹æ¯”**ï¼ŒåŒè¯­è¨€å†…çºµå‘æ’åæ›´æœ‰å‚è€ƒä»·å€¼ã€‚

### 8.1 VCD è§£ææ€§èƒ½å®æµ‹

#### 8.1.1 å…¨é‡è§£æ (Full Parse)

176MB åˆæˆ VCD æ–‡ä»¶ (2000ä¿¡å· Ã— 200Kæ—¶é—´æ­¥):

| æ’å | åº“ | è€—æ—¶ | ååé‡ | è¯­è¨€ |
|------|---|------|--------|------|
| 1 | pywellen | 140ms | 1255 MB/s | Python(Rustæ ¸å¿ƒ) |
| 2 | wellen | 143ms | 1226 MB/s | Rust |
| 3 | rust-vcd | 1.45s | 121 MB/s | Rust |
| 4 | vcdvcd | 6.88s | 25.5 MB/s | Python |
| 5 | vcd-ng | 38.6s | 4.6 MB/s | Rust |

```
  pywellen        |#                             | 140ms
  wellen          |#                             | 143ms
  rust-vcd        |#                             | 1.45s
  vcdvcd          |#####                         | 6.88s
  vcd-ng          |##############################| 38.6s
```

49MB çœŸå®ä¸–ç•Œ VCD (swerv1 å¤„ç†å™¨):

| æ’å | åº“ | è€—æ—¶ | ååé‡ |
|------|---|------|--------|
| 1 | wellen | 19.0ms | 703 MB/s |
| 2 | pywellen | 19.8ms | 677 MB/s |
| 3 | rust-vcd | 74.6ms | 179 MB/s |
| 4 | vcdvcd | 410ms | 32.6 MB/s |
| 5 | vcd-ng | 2.80s | 4.8 MB/s |

#### 8.1.2 å€¼æŸ¥è¯¢ (Value Query â€” æŸ¥è¯¢10ä¸ªä¿¡å·å…¨éƒ¨å€¼å˜åŒ–)

176MB VCD:

| æ’å | åº“ | è€—æ—¶ | è¯´æ˜ |
|------|---|------|------|
| 1 | **vcd-ng** | 163ms | FastFlowé›¶æ‹·è´è§£æå™¨ |
| 2 | wellen | 175ms | mmap + rayon |
| 3 | pywellen | 183ms | åŒwellenæ ¸å¿ƒ |
| 4 | rust-vcd | 1.55s | æµå¼é€å­—èŠ‚ |
| 5 | vcdvcd | 6.84s | Pythoné€è¡Œ |

#### 8.1.3 è¿ç»­æ“ä½œ (Pipeline: Loadâ†’Signal Listâ†’Time Rangeâ†’Value Query)

176MB VCD:

| æ’å | åº“ | è€—æ—¶ | ååé‡ |
|------|---|------|--------|
| 1 | pywellen | 166ms | 1057 MB/s |
| 2 | wellen | 175ms | 1001 MB/s |
| 3 | **vcd-ng** | 181ms | 972 MB/s |
| 4 | rust-vcd | 1.39s | 127 MB/s |
| 5 | vcdvcd | 6.77s | 25.9 MB/s |

#### 8.1.4 VCD æ€§èƒ½æ’åå·®å¼‚æ ¹å› åˆ†æ

**æ ¸å¿ƒå‘ç°: vcd-ng çš„"ä¸¤é¢æ€§"**

vcd-ng åœ¨ full_parse ä¸­æ’åå«åº• (38.6s)ï¼Œä½†åœ¨ value_query å’Œ pipeline ä¸­è·ƒå‡è‡³å‰ä¸‰ (163ms / 181ms)ã€‚
åŸå› æ˜¯ vcd-ng å†…å«**ä¸¤å¥—å®Œå…¨ä¸åŒçš„è§£æå™¨**:

- **`Parser`** (ç”¨äº full_parse): ä½¿ç”¨ `io::Bytes<R>` é€å­—èŠ‚è¯»å– (`vcd-ng/src/read.rs:38`)ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½ç»è¿‡ `Iterator::next()` â†’ `Read::read()` è°ƒç”¨é“¾ï¼Œå¹¶ä¸ºæ¯ä¸ªå€¼å˜åŒ–åˆ†é… `Command` æšä¸¾ + `CompactString`ã€‚å¤„ç† 176MB æ–‡ä»¶æ—¶äº§ç”Ÿæ•°äº¿æ¬¡å‡½æ•°è°ƒç”¨ã€‚
- **`FastFlow`** (ç”¨äº value_query/pipeline): ä½¿ç”¨ `LineReader` 1MB ç¼“å†²åŒº (`fastflow.rs:51`)ï¼Œé›¶æ‹·è´â€”â€”`FFValueChange.bits` ç›´æ¥å¼•ç”¨å†…éƒ¨ buffer çš„ `&[u8]` åˆ‡ç‰‡ï¼Œæ— å†…å­˜åˆ†é…ã€‚è·³è¿‡ `$` å‘½ä»¤ï¼Œä»…è§£ææ—¶é—´æˆ³å’Œå€¼å˜åŒ–ï¼Œä½¿ç”¨ `atoi_radix10` åšå¿«é€Ÿæ•´æ•°è§£æã€‚

ä¸¤è€…å·®è· **~237å€** å®Œå…¨æºäºè¿™ä¸¤æ¡ä»£ç è·¯å¾„çš„æ ¹æœ¬æ¶æ„å·®å¼‚ã€‚

**ä¸ºä»€ä¹ˆ pywellen â‰ˆ wellen é€Ÿåº¦ (PyO3 å¼€é”€å¯å¿½ç•¥)?**

pywellen çš„ `Waveform.__init__()` (`pywellen/src/lib.rs:350-371`) æ˜¯ä¸€æ¬¡æ€§ FFI è°ƒç”¨è¿›å…¥ wellen çš„ Rust æ ¸å¿ƒ:
```rust
fn new(path: String, multi_threaded: bool, ...) -> PyResult<Self> {
    let header_result = viewers::read_header_from_file(path, &opts)?;
    let body = viewers::read_body(header_result.body, &hier, None)?;
    Ok(Self { hierarchy: hier, wave_source: body.source, time_table: ... })
}
```
è¿™ä¸ Rust ç«¯ `wellen::simple::read()` (`simple.rs:18-20`) è°ƒç”¨çš„æ˜¯**åŒä¸€ä¸ªå‡½æ•°**ã€‚è§£æ 176MB æ–‡ä»¶è€—æ—¶ ~140msï¼ŒPyO3 FFI è¾¹ç•Œç©¿è¶Šå¼€é”€ä»…çº³ç§’çº§ï¼Œå®Œå…¨ä¸å¯è§ã€‚pywellen å¶å°”æ¯” wellen å¿«å‡ æ¯«ç§’çº¯å±æµ‹é‡å™ªå£°ã€‚

**wellen ä¸ºä»€ä¹ˆèƒ½è¾¾åˆ° 1.2 GB/s?**

ä¸‰å±‚æ¶æ„å åŠ :
1. **mmap å†…å­˜æ˜ å°„** (`wellen/src/vcd.rs:74`): `memmap2::Mmap::map(&file)` å°†æ•´ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé¿å…æ‰€æœ‰ `read()` ç³»ç»Ÿè°ƒç”¨ï¼Œç”±å†…æ ¸é¡µç¼“å­˜ç®¡ç†é¢„å–
2. **rayon å¤šçº¿ç¨‹åˆ†å—** (`vcd.rs:1070-1134`): å°† VCD body åˆ†æˆ â‰¥8KB çš„å—ï¼Œé€šè¿‡ `par_iter()` å¹¶è¡Œè§£æï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹äº§å‡º `Encoder`ï¼Œç„¶åé¡ºåºåˆå¹¶
3. **wavemem å‹ç¼©å­˜å‚¨** (`wavemem/` æ¨¡å—): LZ4 åˆ†å—å‹ç¼© + LEB128 æ—¶é—´å¢é‡ç¼–ç  + 2/4/9-state è‡ªé€‚åº”å€¼ç¼–ç ï¼Œå‡å°‘å†…å­˜å¸¦å®½å‹åŠ›

**rust-vcd ä¸ºä»€ä¹ˆæ¯” wellen æ…¢ ~10 å€?**

| å› ç´  | rust-vcd | wellen |
|------|----------|--------|
| I/O æ–¹å¼ | `BufReader` (8KBç¼“å†² + syscall) | mmap (é›¶syscall) |
| çº¿ç¨‹æ¨¡å‹ | å•çº¿ç¨‹ | rayon å¹¶è¡Œåˆ†å— |
| è§£ææ–¹å¼ | é€å­—èŠ‚ `io::Bytes` | é€å­—èŠ‚ä½†åœ¨ mmap å†…å­˜ä¸Š |
| äº‹ä»¶å¼€é”€ | `Command` æšä¸¾åˆ†é… | ç´§å‡‘ç¼–ç ï¼Œæ— æšä¸¾ |

ç¼ºå°‘å¤šçº¿ç¨‹çº¦æŸå¤± 4-8xï¼Œç¼ºå°‘ mmap çº¦æŸå¤± 1.5-2xï¼ŒåŠ ä¸Šæ›´é‡çš„äº‹ä»¶åˆ†é…ï¼Œç»¼åˆçº¦ 10xã€‚

**vcdvcd ä¸ºä»€ä¹ˆæ¯” wellen æ…¢ ~50 å€?**

çº¯ Python è§£é‡Šå™¨å¼€é”€:
- æ¯è¡Œ `readline()` åˆ†é… Python å­—ç¬¦ä¸²ï¼Œ`.strip()` å†åˆ†é…ï¼Œ`.split()` å†åˆ†é…åˆ—è¡¨ï¼Œ`int()` å†åˆ†é…æ•´æ•°å¯¹è±¡ (`vcdvcd.py:173-195`)
- æ¯ä¸ªå€¼å˜åŒ–åˆ›å»º `(time, value)` å…ƒç»„å¹¶ `append` åˆ°åˆ—è¡¨ (`vcdvcd.py:281-298`)
- å­—å…¸æŸ¥æ‰¾ `self.data[identifier_code]` çš„ hash è®¡ç®—å¼€é”€
- 176MB æ–‡ä»¶æœ‰æ•°ç™¾ä¸‡è¡Œï¼Œæ„å‘³ç€æ•°ç™¾ä¸‡æ¬¡ä¸´æ—¶å¯¹è±¡åˆ†é…å’Œ GC å‹åŠ›
- æ—  mmapï¼Œæ— å¤šçº¿ç¨‹ï¼Œ`open(path, 'r')` æ–‡æœ¬æ¨¡å¼å¢åŠ ç¼–è§£ç å¼€é”€

### 8.2 FST è§£ææ€§èƒ½å®æµ‹

#### 8.2.1 å…¨é‡è§£æ (Full Parse)

12.8MB åˆæˆ FST æ–‡ä»¶:

| æ’å | åº“ | è€—æ—¶ | ååé‡ | è¯­è¨€ |
|------|---|------|--------|------|
| 1 | wellen | 1.41ms | 9107 MB/s | Rust |
| 2 | pywellen | 1.65ms | 7792 MB/s | Python(Rustæ ¸å¿ƒ) |
| 3 | pylibfst | 4.90ms | 2622 MB/s | Python(C FFI) |
| 4 | fstapi | 277ms | 46.4 MB/s | Rust(C FFI) |
| 5 | fst-reader | 316ms | 40.7 MB/s | Rust(çº¯) |

569KB çœŸå®ä¸–ç•Œ FST (Xilinx ISim):

| æ’å | åº“ | è€—æ—¶ | ååé‡ |
|------|---|------|--------|
| 1 | pywellen | 5.68ms | 97.8 MB/s |
| 2 | wellen | 7.80ms | 71.3 MB/s |
| 3 | fstapi | 25.8ms | 21.6 MB/s |
| 4 | fst-reader | 28.7ms | 19.3 MB/s |
| 5 | pylibfst | 47.5ms | 11.7 MB/s |

#### 8.2.2 å€¼æŸ¥è¯¢ (Value Query)

12.8MB FST:

| æ’å | åº“ | è€—æ—¶ | è¯´æ˜ |
|------|---|------|------|
| 1 | **fstapi** | 23.3ms | C fstlib ä¼˜åŒ–å—éå† |
| 2 | fst-reader | 29.5ms | çº¯ Rust å—éå† |
| 3 | wellen | 78.6ms | fst-reader + SignalWriter é‡ç¼–ç  |
| 4 | pywellen | 80.2ms | åŒ wellen æ ¸å¿ƒ |
| 5 | pylibfst | 222ms | CFFI å›è°ƒå¼€é”€ |

#### 8.2.3 è¿ç»­æ“ä½œ (Pipeline)

12.8MB FST:

| æ’å | åº“ | è€—æ—¶ | ååé‡ |
|------|---|------|--------|
| 1 | fstapi | 22.7ms | 567 MB/s |
| 2 | fst-reader | 28.6ms | 449 MB/s |
| 3 | pywellen | 35.8ms | 359 MB/s |
| 4 | pylibfst | 52.0ms | 247 MB/s |
| 5 | **wellen** | 74.8ms | 172 MB/s |

```
  fstapi          |#########                     | 22.7ms
  fst-reader      |###########                   | 28.6ms
  pywellen        |##############                | 35.8ms
  pylibfst        |####################          | 52.0ms
  wellen          |##############################| 74.8ms
```

#### 8.2.4 FST æ€§èƒ½æ’åå·®å¼‚æ ¹å› åˆ†æ

**æ ¸å¿ƒå‘ç°: wellen çš„ FST "å»¶è¿ŸåŠ è½½"è®¾è®¡**

wellen åœ¨ FST full_parse ä¸­æ’åç¬¬ä¸€ (1.41ms, 9107 MB/s)ï¼Œä½†åœ¨ pipeline ä¸­è·Œè‡³æœ«ä½ (74.8ms)ã€‚
è¿™ä¸æ˜¯å› ä¸º wellen è§£ææ›´å¿«ï¼Œè€Œæ˜¯å› ä¸º **wellen çš„ FST full_parse æ ¹æœ¬æ²¡æœ‰è¯»å–ä¿¡å·æ•°æ®**ã€‚

`wellen::fst::read_body()` (`wellen/src/fst.rs:55-64`) ä»…åŒ…è£… `FstReader` å¥æŸ„:
```rust
pub fn read_body<R>(data: ReadBodyContinuation<R>) -> Result<(SignalSource, TimeTable)> {
    let time_table = data.0.get_time_table().unwrap().to_vec();
    let reader = data.0;
    let db = FstWaveDatabase::new(reader);  // ä»…å­˜å‚¨ readerï¼Œä¸è¯»æ•°æ®
    Ok((SignalSource::new(Box::new(db)), time_table))
}
```
æºç æ³¨é‡Š (`viewers.rs:71`): `"fst never reads the full body (unless all signals are displayed)"`ã€‚wellen çš„ 1.41ms å®é™…åªåŒ…å«: æ–‡ä»¶æ‰“å¼€ + header è§£æ + hierarchy è¯»å– + time_table æå–ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼Œfstapi (277ms) å’Œ fst-reader (316ms) çš„ full_parse benchmark æ˜¯**çœŸæ­£è¯»å–å…¨éƒ¨ä¿¡å·æ•°æ®**: `reader.for_each_block()` / `reader.read_signals(&FstFilter::all(), ...)` éå†æ‰€æœ‰å€¼å˜åŒ–ã€‚

åœ¨ pipeline ä¸­ï¼Œwellen å¿…é¡»è°ƒç”¨ `load_signals()` (`fst.rs:79-123`) è¡¥å›å»¶è¿Ÿçš„å·¥ä½œ:
1. åˆ›å»º FstFilter ä»ä¿¡å·å¥æŸ„
2. **é€šè¿‡å†…éƒ¨çš„ fst-reader è¯»å– FST æ•°æ®æ®µ** (ç»§æ‰¿ fst-reader çš„ I/O å¼€é”€)
3. ä¸ºæ¯ä¸ªå€¼å˜åŒ–æ„å»º SignalWriter: çŠ¶æ€æ£€æµ‹ã€å­—èŠ‚å±•å¼€ã€å˜åŒ–å»é‡ (`fst.rs:153-266`)
4. `expand_entries()` (`fst.rs:333-381`) åœ¨ 2-state â†’ 4-state â†’ 9-state å‡çº§æ—¶é‡ç¼–ç å…¨éƒ¨å·²æœ‰æ•°æ®

è¿™ç§ **åŒé‡å¤„ç†** (fst-reader I/O + SignalWriter é‡ç¼–ç ) å¯¼è‡´ wellen pipeline = 74.8msï¼Œæ¯”ç›´æ¥ç”¨ fst-reader (28.6ms) æ…¢ 2.6 å€ã€‚

**fstapi vs fst-reader: C åº“ä¼˜åŒ– vs çº¯ Rust å®‰å…¨**

å€¼æŸ¥è¯¢ä¸­ fstapi (23.3ms) æ¯” fst-reader (29.5ms) å¿« ~27%:
- fstapi é€šè¿‡ FFI è°ƒç”¨ GTKWave C å‚è€ƒå®ç° `fstReaderIterBlocks2()`ï¼Œè¯¥å‡½æ•°ç»è¿‡åä½™å¹´ä¼˜åŒ–
- fst-reader ç”¨çº¯ Rust é‡å†™äº† FST å—éå†é€»è¾‘ (`fst-reader/src/reader.rs:650-843`)ï¼Œä½¿ç”¨ `miniz_oxide` ä»£æ›¿ C `zlib`ï¼ŒRust å®‰å…¨æŠ½è±¡å¸¦æ¥å°‘é‡é¢å¤–å¼€é”€

ä½†ä¿¡å·åˆ—è¡¨ä¸­ fst-reader (236Î¼s) æ¯” fstapi (644Î¼s) å¿« 2.7 å€:
- fst-reader çš„ `read_hierarchy()` æ˜¯ç²¾ç®€çš„å›è°ƒå¼éå† (`reader.rs:310-323`)
- fstapi çš„ `vars()` è¿­ä»£å™¨é€é¡¹ç©¿è¶Š Rust-C FFI è¾¹ç•Œï¼Œä¸”ä¸ºæ¯ä¸ªå˜é‡ç”¨ `format!("{}.{}")` æ‹¼æ¥å®Œæ•´å±‚æ¬¡è·¯å¾„ (`fstapi/reader.rs:429-468`)

**pylibfst ä¸ºä»€ä¹ˆæ¯” pywellen æ…¢ 3-20 å€?**

å…³é”®å·®å¼‚åœ¨äº**æ¯å€¼å˜åŒ–çš„å›è°ƒå¼€é”€**:

pylibfst ä½¿ç”¨ CFFI å›è°ƒæœºåˆ¶ (`pylibfst/helpers.py:136-144`):
```python
def pylibfst_wrapped_value_change_callback(data, time, facidx, value):
    data = ffi.from_handle(data)  # CFFI ä¸Šä¸‹æ–‡æ¢å¤
    data[0](data[2], time, facidx, value)  # Python å‡½æ•°è°ƒç”¨
```
FST æ–‡ä»¶ä¸­çš„**æ¯ä¸€ä¸ªå€¼å˜åŒ–**éƒ½è§¦å‘ä¸€æ¬¡ Câ†’Python ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚12.8MB FST æœ‰æ•°ç™¾ä¸‡æ¬¡å€¼å˜åŒ–ï¼Œæ„å‘³ç€æ•°ç™¾ä¸‡æ¬¡ `ffi.from_handle()` + Python å‡½æ•°è°ƒåº¦ã€‚

pywellen é€šè¿‡ PyO3 åœ¨ Rust å†…éƒ¨å®Œæˆæ‰€æœ‰å€¼éå†ï¼Œä»…åœ¨æœ€ç»ˆç»“æœæ—¶ç©¿è¶Šä¸€æ¬¡ Rustâ†’Python è¾¹ç•Œã€‚å¯¹äºå€¼æŸ¥è¯¢: pywellen 80ms vs pylibfst 222msï¼Œå·®è· 2.8 å€å®Œå…¨æºäºå›è°ƒæ¶æ„å·®å¼‚ã€‚

### 8.3 è·¨æ ¼å¼æ€§èƒ½æ€»ç»“

#### 8.3.1 æ¶æ„ç­–ç•¥å¯¹ç…§è¡¨

| åº“ | I/O ç­–ç•¥ | çº¿ç¨‹æ¨¡å‹ | è§£ææ–¹å¼ | æ¯äº‹ä»¶å¼€é”€ | æœ€ä¼˜åœºæ™¯ |
|---|---|---|---|---|---|
| wellen | mmap | rayonå¹¶è¡Œ | å­—èŠ‚çº§(mmapä¸Š) | ç´§å‡‘wavememç¼–ç  | VCDå…¨é‡è§£æ |
| pywellen | åŒwellen | åŒwellen | åŒwellen(PyO3) | åŒwellen | Pythonä¸­è§£æVCD |
| rust-vcd | BufReader | å•çº¿ç¨‹ | é€å­—èŠ‚io::Bytes | Commandæšä¸¾åˆ†é… | é€šç”¨VCDæµå¼å¤„ç† |
| vcd-ng Parser | io::Bytes | å•çº¿ç¨‹ | é€å­—èŠ‚ | Command+CompactString | ä¸æ¨èå•ç‹¬ä½¿ç”¨ |
| vcd-ng FastFlow | LineReader 1MB | å•çº¿ç¨‹ | é›¶æ‹·è´è¡Œçº§ | å€Ÿç”¨åˆ‡ç‰‡,æ— åˆ†é… | VCDå€¼æµå¼è¿‡æ»¤ |
| fst-reader | BufRead+Seek | å•çº¿ç¨‹ | å—çº§é¡ºåº | å›è°ƒ,æ— å­˜å‚¨ | çº¯Rust FSTè¯»å– |
| fstapi | C mmap | Cç«¯ä¼˜åŒ– | Cå—çº§ | Cç«¯ä¼˜åŒ–ç¼–ç  | FSTå€¼æ‰¹é‡éå† |
| pylibfst | C mmap(CFFI) | Cç«¯ | Cå—çº§+Pyå›è°ƒ | CFFIä¸Šä¸‹æ–‡åˆ‡æ¢ | Pythonå°è§„æ¨¡FST |
| vcdvcd | Python readline | å•çº¿ç¨‹ | é€è¡Œå­—ç¬¦æ´¾å‘ | å…ƒç»„+å­—å…¸+å­—ç¬¦ä¸²åˆ†é… | Pythonå°æ–‡ä»¶åˆ†æ |

#### 8.3.2 ä¸åŒæ“ä½œçš„æœ€ä¼˜åº“é€‰æ‹©

| æ“ä½œ | VCD æœ€å¿« | FST æœ€å¿« | è¯´æ˜ |
|------|----------|----------|------|
| å…¨é‡è§£æ | wellen/pywellen (1.2GB/s) | fstapi (46MB/sçœŸå®) | wellen FSTçš„9GB/sæ˜¯å»¶è¿ŸåŠ è½½,éçœŸå®å…¨è§£æ |
| ä¿¡å·åˆ—è¡¨ | rust-vcd (370Î¼s) | fst-reader (236Î¼s) | ä»…è§£æheader/hierarchy |
| å€¼æŸ¥è¯¢ | vcd-ng FastFlow (163ms) | fstapi (23ms) | ä¸“ç”¨é«˜é€Ÿæ•°æ®æ®µè§£æ |
| è¿ç»­æ“ä½œ | wellen/pywellen (166-175ms) | fstapi (22.7ms) | å•éå¤„ç†æœ€ä¼˜ |

#### 8.3.3 æ€§èƒ½ä¸æ˜“ç”¨æ€§æƒè¡¡

```
æ€§èƒ½ (throughput)
  â–²
  â”‚  wellen â—â”€â”€â”€â”€â”€â”€â”€ åŠŸèƒ½æœ€å…¨ï¼ŒVCDæœ€å¿«
  â”‚         pywellen â—â”€â”€ Pythonä¸­ä¹Ÿèƒ½è·å¾—Rustæ€§èƒ½
  â”‚
  â”‚  vcd-ng(FF) â—â”€â”€â”€â”€ VCDå€¼æŸ¥è¯¢ä¸“ç”¨æœ€å¿«
  â”‚  rust-vcd â—â”€â”€â”€â”€â”€â”€ é›¶ä¾èµ–ï¼Œé€šç”¨æµå¼
  â”‚  fstapi â—â”€â”€â”€â”€â”€â”€â”€â”€ FSTå€¼éå†æœ€å¿«(Cæ ¸å¿ƒ)
  â”‚  fst-reader â—â”€â”€â”€â”€ çº¯Rust FSTï¼Œæ¥è¿‘Cæ€§èƒ½
  â”‚
  â”‚  pylibfst â—â”€â”€â”€â”€â”€â”€ Python FSTï¼ŒCFFIæœ‰å¼€é”€
  â”‚  vcdvcd â—â”€â”€â”€â”€â”€â”€â”€â”€ Python VCDï¼Œæœ€ç®€å•
  â”‚  vcd-ng(Parser) â—â”€â”€ å…¨è§£æä¸æ¨èä½¿ç”¨
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ æ˜“ç”¨æ€§/é›¶ä¾èµ–
```

---

## ä¹ã€ç»“è®º

1. **å¦‚æœåªé€‰ä¸€ä¸ªRuståº“**: é€‰ **wellen**ã€‚å®ƒæ˜¯ç›®å‰ç¤¾åŒºæœ€æ´»è·ƒ(88ä¸ªrelease)ã€åŠŸèƒ½æœ€å…¨(3æ ¼å¼)ã€æ€§èƒ½æœ€ä¼˜(å¤šçº¿ç¨‹+å‹ç¼©å­˜å‚¨)çš„æ³¢å½¢åº“ï¼Œä¸”ç”±Surferé¡¹ç›®æŒç»­éªŒè¯ã€‚

2. **å¦‚æœåªéœ€VCDè¯»å†™**: é€‰ **rust-vcd**ã€‚é›¶ä¾èµ–ã€æˆç†Ÿç¨³å®šã€APIè®¾è®¡ä¼˜ç§€ã€‚æ€§èƒ½æ•æ„Ÿåœºæ™¯å¯è€ƒè™‘ **vcd-ng** çš„FastFlowã€‚

3. **å¦‚æœåªéœ€FST**: çº¯Rusté€‰ **fst-reader**(è¯») + **fst-writer**(å†™)ï¼›éœ€å®Œæ•´åŠŸèƒ½(å¹¶è¡Œå†™)é€‰ **fstapi**ã€‚

4. **Pythonåœºæ™¯**: VCDç”¨ **vcdvcd**(é›¶ä¾èµ–)ï¼ŒFSTç”¨ **pylibfst**(Cæ€§èƒ½)ã€‚

5. **CåµŒå…¥åœºæ™¯**: **gtkwave/libfst** æ˜¯å”¯ä¸€ä¸”æ ‡å‡†çš„é€‰æ‹©ï¼Œ6ä¸ªæ–‡ä»¶å³å¯ç‹¬ç«‹ç¼–è¯‘ã€‚
